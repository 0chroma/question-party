/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

/*
	This is a compiled version of Dojo, built for deployment and not for
	development. To get an editable version, please visit:

		http://dojotoolkit.org

	for documentation and information on getting the source.
*/

if(!dojo._hasResource["dojo.AdapterRegistry"]){dojo._hasResource["dojo.AdapterRegistry"]=true;dojo.provide("dojo.AdapterRegistry");dojo.AdapterRegistry=function(_1){this.pairs=[];this.returnWrappers=_1||false;};dojo.extend(dojo.AdapterRegistry,{register:function(_2,_3,_4,_5,_6){this.pairs[((_6)?"unshift":"push")]([_2,_3,_4,_5]);},match:function(){for(var i=0;i<this.pairs.length;i++){var _7=this.pairs[i];if(_7[1].apply(this,arguments)){if((_7[3])||(this.returnWrappers)){return _7[2];}else{return _7[2].apply(this,arguments);}}}throw new Error("No match found");},unregister:function(_8){for(var i=0;i<this.pairs.length;i++){var _9=this.pairs[i];if(_9[0]==_8){this.pairs.splice(i,1);return true;}}return false;}});}if(!dojo._hasResource["dojox.cometd._base"]){dojo._hasResource["dojox.cometd._base"]=true;dojo.provide("dojox.cometd._base");dojox.cometd={Connection:function(_a){dojo.mixin(this,{prefix:_a,_status:"unconnected",_handshook:false,_initialized:false,_polling:false,expectedNetworkDelay:10000,connectTimeout:0,version:"1.0",minimumVersion:"0.9",clientId:null,messageId:0,batch:0,_isXD:false,handshakeReturn:null,currentTransport:null,url:null,lastMessage:null,_messageQ:[],handleAs:"json",_advice:{},_backoffInterval:0,_backoffIncrement:1000,_backoffMax:60000,_deferredSubscribes:{},_deferredUnsubscribes:{},_subscriptions:[],_extendInList:[],_extendOutList:[]});this.state=function(){return this._status;};this.init=function(_b,_c,_d){_c=_c||{};_c.version=this.version;_c.minimumVersion=this.minimumVersion;_c.channel="/meta/handshake";_c.id=""+this.messageId++;this.url=_b||dojo.config["cometdRoot"];if(!this.url){throw "no cometd root";return null;}var _e="^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$";var _f=(""+window.location).match(new RegExp(_e));if(_f[4]){var tmp=_f[4].split(":");var _10=tmp[0];var _11=tmp[1]||"80";_f=this.url.match(new RegExp(_e));if(_f[4]){tmp=_f[4].split(":");var _12=tmp[0];var _13=tmp[1]||"80";this._isXD=((_12!=_10)||(_13!=_11));}}if(!this._isXD){_c.supportedConnectionTypes=dojo.map(dojox.cometd.connectionTypes.pairs,"return item[0]");}_c=this._extendOut(_c);var _14={url:this.url,handleAs:this.handleAs,content:{"message":dojo.toJson([_c])},load:dojo.hitch(this,function(msg){this._backon();this._finishInit(msg);}),error:dojo.hitch(this,function(e){this._backoff();this._finishInit(e);}),timeout:this.expectedNetworkDelay};if(_d){dojo.mixin(_14,_d);}this._props=_c;for(var _15 in this._subscriptions){for(var sub in this._subscriptions[_15]){if(this._subscriptions[_15][sub].topic){dojo.unsubscribe(this._subscriptions[_15][sub].topic);}}}this._messageQ=[];this._subscriptions=[];this._initialized=true;this._status="handshaking";this.batch=0;this.startBatch();var r;if(this._isXD){_14.callbackParamName="jsonp";r=dojo.io.script.get(_14);}else{r=dojo.xhrPost(_14);}return r;};this.publish=function(_16,_17,_18){var _19={data:_17,channel:_16};if(_18){dojo.mixin(_19,_18);}this._sendMessage(_19);};this.subscribe=function(_1a,_1b,_1c,_1d){_1d=_1d||{};if(_1b){var _1e=_a+_1a;var _1f=this._subscriptions[_1e];if(!_1f||_1f.length==0){_1f=[];_1d.channel="/meta/subscribe";_1d.subscription=_1a;this._sendMessage(_1d);var _20=this._deferredSubscribes;if(_20[_1a]){_20[_1a].cancel();delete _20[_1a];}_20[_1a]=new dojo.Deferred();}for(var i in _1f){if(_1f[i].objOrFunc===_1b&&(!_1f[i].funcName&&!_1c||_1f[i].funcName==_1c)){return null;}}var _21=dojo.subscribe(_1e,_1b,_1c);_1f.push({topic:_21,objOrFunc:_1b,funcName:_1c});this._subscriptions[_1e]=_1f;}var ret=this._deferredSubscribes[_1a]||{};ret.args=dojo._toArray(arguments);return ret;};this.unsubscribe=function(_22,_23,_24,_25){if((arguments.length==1)&&(!dojo.isString(_22))&&(_22.args)){return this.unsubscribe.apply(this,_22.args);}var _26=_a+_22;var _27=this._subscriptions[_26];if(!_27||_27.length==0){return null;}var s=0;for(var i in _27){var sb=_27[i];if((!_23)||(sb.objOrFunc===_23&&(!sb.funcName&&!_24||sb.funcName==_24))){dojo.unsubscribe(_27[i].topic);delete _27[i];}else{s++;}}if(s==0){_25=_25||{};_25.channel="/meta/unsubscribe";_25.subscription=_22;delete this._subscriptions[_26];this._sendMessage(_25);this._deferredUnsubscribes[_22]=new dojo.Deferred();if(this._deferredSubscribes[_22]){this._deferredSubscribes[_22].cancel();delete this._deferredSubscribes[_22];}}return this._deferredUnsubscribes[_22];};this.disconnect=function(){for(var _28 in this._subscriptions){for(var sub in this._subscriptions[_28]){if(this._subscriptions[_28][sub].topic){dojo.unsubscribe(this._subscriptions[_28][sub].topic);}}}this._subscriptions=[];this._messageQ=[];if(this._initialized&&this.currentTransport){this._initialized=false;this.currentTransport.disconnect();}if(!this._polling){this._publishMeta("connect",false);}this._initialized=false;this._handshook=false;this._status="disconnected";this._publishMeta("disconnect",true);};this.subscribed=function(_29,_2a){};this.unsubscribed=function(_2b,_2c){};this.tunnelInit=function(_2d,_2e){};this.tunnelCollapse=function(){};this._backoff=function(){if(!this._advice){this._advice={reconnect:"retry",interval:0};}else{if(!this._advice.interval){this._advice.interval=0;}}if(this._backoffInterval<this._backoffMax){this._backoffInterval+=this._backoffIncrement;}};this._backon=function(){this._backoffInterval=0;};this._interval=function(){var i=this._backoffInterval+(this._advice?(this._advice.interval?this._advice.interval:0):0);if(i>0){console.log("Retry in interval+backoff="+this._advice.interval+"+"+this._backoffInterval+"="+i+"ms");}return i;};this._publishMeta=function(_2f,_30,_31){try{var _32={cometd:this,action:_2f,successful:_30,state:this.state()};if(_31){dojo.mixin(_32,_31);}dojo.publish(this.prefix+"/meta",[_32]);}catch(e){console.log(e);}};this._finishInit=function(_33){if(this._status!="handshaking"){return;}var _34=this._handshook;var _35=false;var _36={};if(_33 instanceof Error){dojo.mixin(_36,{reestablish:false,failure:true,error:_33,advice:this._advice});}else{_33=_33[0];_33=this._extendIn(_33);this.handshakeReturn=_33;if(_33["advice"]){this._advice=_33.advice;}_35=_33.successful?_33.successful:false;if(_33.version<this.minimumVersion){if(console.log){console.log("cometd protocol version mismatch. We wanted",this.minimumVersion,"but got",_33.version);}_35=false;this._advice.reconnect="none";}dojo.mixin(_36,{reestablish:_35&&_34,response:_33});}this._publishMeta("handshake",_35,_36);if(this._status!="handshaking"){return;}if(_35){this._status="connecting";this._handshook=true;this.currentTransport=dojox.cometd.connectionTypes.match(_33.supportedConnectionTypes,_33.version,this._isXD);var _37=this.currentTransport;_37._cometd=this;_37.version=_33.version;this.clientId=_33.clientId;this.tunnelInit=_37.tunnelInit&&dojo.hitch(_37,"tunnelInit");this.tunnelCollapse=_37.tunnelCollapse&&dojo.hitch(_37,"tunnelCollapse");_37.startup(_33);}else{if(!this._advice||this._advice["reconnect"]!="none"){setTimeout(dojo.hitch(this,"init",this.url,this._props),this._interval());}}};this._extendIn=function(_38){dojo.forEach(dojox.cometd._extendInList,function(f){_38=f(_38)||_38;});return _38;};this._extendOut=function(_39){dojo.forEach(dojox.cometd._extendOutList,function(f){_39=f(_39)||_39;});return _39;};this.deliver=function(_3a){dojo.forEach(_3a,this._deliver,this);return _3a;};this._deliver=function(_3b){_3b=this._extendIn(_3b);if(!_3b["channel"]){if(_3b["success"]!==true){return;}}this.lastMessage=_3b;if(_3b.advice){this._advice=_3b.advice;}var _3c=null;if((_3b["channel"])&&(_3b.channel.length>5)&&(_3b.channel.substr(0,5)=="/meta")){switch(_3b.channel){case "/meta/connect":var _3d={response:_3b};if(_3b.successful){if(this._status!="connected"){this._status="connected";this.endBatch();}}if(this._initialized){this._publishMeta("connect",_3b.successful,_3d);}break;case "/meta/subscribe":_3c=this._deferredSubscribes[_3b.subscription];try{if(!_3b.successful){if(_3c){_3c.errback(new Error(_3b.error));}this.currentTransport.cancelConnect();return;}if(_3c){_3c.callback(true);}this.subscribed(_3b.subscription,_3b);}catch(e){log.warn(e);}break;case "/meta/unsubscribe":_3c=this._deferredUnsubscribes[_3b.subscription];try{if(!_3b.successful){if(_3c){_3c.errback(new Error(_3b.error));}this.currentTransport.cancelConnect();return;}if(_3c){_3c.callback(true);}this.unsubscribed(_3b.subscription,_3b);}catch(e){log.warn(e);}break;default:if(_3b.successful&&!_3b.successful){this.currentTransport.cancelConnect();return;}}}this.currentTransport.deliver(_3b);if(_3b.data){try{var _3e=[_3b];var _3f=_a+_3b.channel;var _40=_3b.channel.split("/");var _41=_a;for(var i=1;i<_40.length-1;i++){dojo.publish(_41+"/**",_3e);_41+="/"+_40[i];}dojo.publish(_41+"/**",_3e);dojo.publish(_41+"/*",_3e);dojo.publish(_3f,_3e);}catch(e){console.log(e);}}};this._sendMessage=function(_42){if(this.currentTransport&&!this.batch){return this.currentTransport.sendMessages([_42]);}else{this._messageQ.push(_42);return null;}};this.startBatch=function(){this.batch++;};this.endBatch=function(){if(--this.batch<=0&&this.currentTransport&&this._status=="connected"){this.batch=0;var _43=this._messageQ;this._messageQ=[];if(_43.length>0){this.currentTransport.sendMessages(_43);}}};this._onUnload=function(){dojo.addOnUnload(dojox.cometd,"disconnect");};this._connectTimeout=function(){var _44=0;if(this._advice&&this._advice.timeout&&this.expectedNetworkDelay>0){_44=this._advice.timeout+this.expectedNetworkDelay;}if(this.connectTimeout>0&&this.connectTimeout<_44){return this.connectTimeout;}return _44;};},connectionTypes:new dojo.AdapterRegistry(true)};dojox.cometd.Connection.call(dojox.cometd,"/cometd");dojo.addOnUnload(dojox.cometd,"_onUnload");}if(!dojo._hasResource["dojox.cometd.longPollTransportJsonEncoded"]){dojo._hasResource["dojox.cometd.longPollTransportJsonEncoded"]=true;dojo.provide("dojox.cometd.longPollTransportJsonEncoded");dojox.cometd.longPollTransportJsonEncoded=new function(){this._connectionType="long-polling";this._cometd=null;this.check=function(_45,_46,_47){return ((!_47)&&(dojo.indexOf(_45,"long-polling")>=0));};this.tunnelInit=function(){var _48={channel:"/meta/connect",clientId:this._cometd.clientId,connectionType:this._connectionType,id:""+this._cometd.messageId++};_48=this._cometd._extendOut(_48);this.openTunnelWith([_48]);};this.tunnelCollapse=function(){if(!this._cometd._initialized){return;}if(this._cometd._advice&&this._cometd._advice["reconnect"]=="none"){return;}if(this._cometd._status=="connected"){setTimeout(dojo.hitch(this,function(){this._connect();}),this._cometd._interval());}else{setTimeout(dojo.hitch(this._cometd,function(){this.init(this.url,this._props);}),this._cometd._interval());}};this._connect=function(){if(!this._cometd._initialized){return;}if(this._cometd._polling){return;}if((this._cometd._advice)&&(this._cometd._advice["reconnect"]=="handshake")){this._cometd._status="unconnected";this._initialized=false;this._cometd.init(this._cometd.url,this._cometd._props);}else{if(this._cometd._status=="connected"){var _49={channel:"/meta/connect",connectionType:this._connectionType,clientId:this._cometd.clientId,id:""+this._cometd.messageId++};if(this._cometd.connectTimeout>=this._cometd.expectedNetworkDelay){_49.advice={timeout:(this._cometd.connectTimeout-this._cometd.expectedNetworkDelay)};}_49=this._cometd._extendOut(_49);this.openTunnelWith([_49]);}}};this.deliver=function(_4a){};this.openTunnelWith=function(_4b,url){this._cometd._polling=true;var _4c={url:(url||this._cometd.url),postData:dojo.toJson(_4b),contentType:"text/json;charset=UTF-8",handleAs:this._cometd.handleAs,load:dojo.hitch(this,function(_4d){this._cometd._polling=false;this._cometd.deliver(_4d);this._cometd._backon();this.tunnelCollapse();}),error:dojo.hitch(this,function(err){this._cometd._polling=false;var _4e={failure:true,error:err,advice:this._cometd._advice};this._cometd._publishMeta("connect",false,_4e);this._cometd._backoff();this.tunnelCollapse();})};var _4f=this._cometd._connectTimeout();if(_4f>0){_4c.timeout=_4f;}this._poll=dojo.rawXhrPost(_4c);};this.sendMessages=function(_50){for(var i=0;i<_50.length;i++){_50[i].clientId=this._cometd.clientId;_50[i].id=""+this._cometd.messageId++;_50[i]=this._cometd._extendOut(_50[i]);}return dojo.rawXhrPost({url:this._cometd.url||dojo.config["cometdRoot"],handleAs:this._cometd.handleAs,load:dojo.hitch(this._cometd,"deliver"),postData:dojo.toJson(_50),contentType:"text/json;charset=UTF-8",error:dojo.hitch(this,function(err){this._cometd._publishMeta("publish",false,{messages:_50});}),timeout:this._cometd.expectedNetworkDelay});};this.startup=function(_51){if(this._cometd._status=="connected"){return;}this.tunnelInit();};this.disconnect=function(){var _52={channel:"/meta/disconnect",clientId:this._cometd.clientId,id:""+this._cometd.messageId++};_52=this._cometd._extendOut(_52);dojo.rawXhrPost({url:this._cometd.url||dojo.config["cometdRoot"],handleAs:this._cometd.handleAs,postData:dojo.toJson([_52]),contentType:"text/json;charset=UTF-8"});};this.cancelConnect=function(){if(this._poll){this._poll.cancel();this._cometd._polling=false;this._cometd._publishMeta("connect",false,{cancel:true});this._cometd._backoff();this.disconnect();this.tunnelCollapse();}};};dojox.cometd.longPollTransport=dojox.cometd.longPollTransportJsonEncoded;dojox.cometd.connectionTypes.register("long-polling",dojox.cometd.longPollTransport.check,dojox.cometd.longPollTransportJsonEncoded);dojox.cometd.connectionTypes.register("long-polling-json-encoded",dojox.cometd.longPollTransport.check,dojox.cometd.longPollTransportJsonEncoded);}if(!dojo._hasResource["dojox.cometd.longPollTransport"]){dojo._hasResource["dojox.cometd.longPollTransport"]=true;dojo.provide("dojox.cometd.longPollTransport");}
