/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

/*
	This is a compiled version of Dojo, built for deployment and not for
	development. To get an editable version, please visit:

		http://dojotoolkit.org

	for documentation and information on getting the source.
*/

if(!dojo._hasResource["dojox.json.query"]){dojo._hasResource["dojox.json.query"]=true;dojo.provide("dojox.json.query");(function(){function s(_1,_2,_3,_4){var _5=_1.length,_6=[];_3=_3||_5;_2=(_2<0)?Math.max(0,_2+_5):Math.min(_5,_2);_3=(_3<0)?Math.max(0,_3+_5):Math.min(_5,_3);for(var i=_2;i<_3;i+=_4){_6.push(_1[i]);}return _6;};function e(_7,_8){var _9=[];function _a(_b){if(_8){if(_8===true&&!(_b instanceof Array)){_9.push(_b);}else{if(_b[_8]){_9.push(_b[_8]);}}}for(var i in _b){var _c=_b[i];if(!_8){_9.push(_c);}else{if(_c&&typeof _c=="object"){_a(_c);}}}};if(_8 instanceof Array){if(_8.length==1){return _7[_8[0]];}for(var i=0;i<_8.length;i++){_9.push(_7[_8[i]]);}}else{_a(_7);}return _9;};function _d(_e,_f){var _10=[];var _11={};for(var i=0,l=_e.length;i<l;++i){var _12=_e[i];if(_f(_12,i,_e)){if((typeof _12=="object")&&_12){if(!_12.__included){_12.__included=true;_10.push(_12);}}else{if(!_11[_12+typeof _12]){_11[_12+typeof _12]=true;_10.push(_12);}}}}for(i=0,l=_10.length;i<l;++i){if(_10[i]){delete _10[i].__included;}}return _10;};dojox.json.query=function(_13,obj){var _14=0;var str=[];_13=_13.replace(/"(\\.|[^"\\])*"|'(\\.|[^'\\])*'|[\[\]]/g,function(t){_14+=t=="["?1:t=="]"?-1:0;return (t=="]"&&_14>0)?"`]":(t.charAt(0)=="\""||t.charAt(0)=="'")?"`"+(str.push(t)-1):t;});var _15="";function _16(_17){_15=_17+"("+_15;};function _18(t,a,b,c,d,e,f,g){return str[g].match(/[\*\?]/)||f=="~"?"/^"+str[g].substring(1,str[g].length-1).replace(/\\([btnfr\\"'])|([^\w\*\?])/g,"\\$1$2").replace(/([\*\?])/g,"[\\w\\W]$1")+(f=="~"?"$/i":"$/")+".test("+a+")":t;};_13.replace(/(\]|\)|push|pop|shift|splice|sort|reverse)\s*\(/,function(){throw new Error("Unsafe function call");});_13=_13.replace(/([^=]=)([^=])/g,"$1=$2").replace(/@|(\.\s*)?[a-zA-Z\$_]+(\s*:)?/g,function(t){return t.charAt(0)=="."?t:t=="@"?"$obj":(t.match(/:|^(\$|Math|true|false|null)$/)?"":"$obj.")+t;}).replace(/\.?\.?\[(`\]|[^\]])*\]|\?.*|\.\.([\w\$_]+)|\.\*/g,function(t,a,b){var _19=t.match(/^\.?\.?(\[\s*\^?\?|\^?\?|\[\s*==)(.*?)\]?$/);if(_19){var _1a="";if(t.match(/^\./)){_16("e");_1a=",true)";}_16(_19[1].match(/\=/)?"dojo.map":_19[1].match(/\^/)?"distinctFilter":"dojo.filter");return _1a+",function($obj){return "+_19[2]+"})";}_19=t.match(/^\[\s*([\/\\].*)\]/);if(_19){return ".concat().sort(function(a,b){"+_19[1].replace(/\s*,?\s*([\/\\])\s*([^,\\\/]+)/g,function(t,a,b){return "var av= "+b.replace(/\$obj/,"a")+",bv= "+b.replace(/\$obj/,"b")+";if(av>bv||bv==null){return "+(a=="/"?1:-1)+";}\n"+"if(bv>av||av==null){return "+(a=="/"?-1:1)+";}\n";})+"return 0;})";}_19=t.match(/^\[(-?[0-9]*):(-?[0-9]*):?(-?[0-9]*)\]/);if(_19){_16("s");return ","+(_19[1]||0)+","+(_19[2]||0)+","+(_19[3]||1)+")";}if(t.match(/^\.\.|\.\*|\[\s*\*\s*\]|,/)){_16("e");return (t.charAt(1)=="."?",'"+b+"'":t.match(/,/)?","+t:"")+")";}return t;}).replace(/(\$obj\s*((\.\s*[\w_$]+\s*)|(\[\s*`([0-9]+)\s*`\]))*)(==|~)\s*`([0-9]+)/g,_18).replace(/`([0-9]+)\s*(==|~)\s*(\$obj\s*((\.\s*[\w_$]+)|(\[\s*`([0-9]+)\s*`\]))*)/g,function(t,a,b,c,d,e,f,g){return _18(t,c,d,e,f,g,b,a);});_13=_15+(_13.charAt(0)=="$"?"":"$")+_13.replace(/`([0-9]+|\])/g,function(t,a){return a=="]"?"]":str[a];});var _1b=eval("1&&function($,$1,$2,$3,$4,$5,$6,$7,$8,$9){var $obj=$;return "+_13+"}");for(var i=0;i<arguments.length-1;i++){arguments[i]=arguments[i+1];}return obj?_1b.apply(this,arguments):_1b;};})();}if(!dojo._hasResource["dojo.data.util.filter"]){dojo._hasResource["dojo.data.util.filter"]=true;dojo.provide("dojo.data.util.filter");dojo.data.util.filter.patternToRegExp=function(_1c,_1d){var rxp="^";var c=null;for(var i=0;i<_1c.length;i++){c=_1c.charAt(i);switch(c){case "\\":rxp+=c;i++;rxp+=_1c.charAt(i);break;case "*":rxp+=".*";break;case "?":rxp+=".";break;case "$":case "^":case "/":case "+":case ".":case "|":case "(":case ")":case "{":case "}":case "[":case "]":rxp+="\\";default:rxp+=c;}}rxp+="$";if(_1d){return new RegExp(rxp,"mi");}else{return new RegExp(rxp,"m");}};}if(!dojo._hasResource["dojox.data.ClientFilter"]){dojo._hasResource["dojox.data.ClientFilter"]=true;dojo.provide("dojox.data.ClientFilter");(function(){var cf;var _1e=function(_1f,_20,_21){return function(_22){_1f._updates.push({create:_20&&_22,remove:_21&&_22});cf.onUpdate();};};cf=dojo.declare("dojox.data.ClientFilter",null,{cacheByDefault:false,constructor:function(){this.onSet=_1e(this,true,true);this.onNew=_1e(this,true,false);this.onDelete=_1e(this,false,true);this._updates=[];this._fetchCache=[];},clearCache:function(){this._fetchCache=[];},updateResultSet:function(_23,_24){if(this.isUpdateable(_24)){for(var i=_24._version||0;i<this._updates.length;i++){var _25=this._updates[i].create;var _26=this._updates[i].remove;if(_26){for(var j=0;j<_23.length;j++){if(_23[j]==_26){_23.splice(j--,1);var _27=true;}}}if(_25&&this.matchesQuery(_25,_24)&&dojo.indexOf(_23,_25)==-1){_23.push(_25);_27=true;}}if(_24.sort&&_27){_23.sort(this.makeComparator(_24.sort.concat()));}_23._fullLength=_23.length;if(_24.count&&_27&&_24.count!==Infinity){_23.splice(_24.count,_23.length);}_24._version=this._updates.length;return _27?2:1;}return 0;},querySuperSet:function(_28,_29){if(_28.query==_29.query){return {};}if(!(_29.query instanceof Object&&(!_28.query||typeof _28.query=="object"))){return false;}var _2a=dojo.mixin({},_29.query);for(var i in _28.query){if(_2a[i]==_28.query[i]){delete _2a[i];}else{if(!(typeof _28.query[i]=="string"&&dojo.data.util.filter.patternToRegExp(_28.query[i]).test(_2a[i]))){return false;}}}return _2a;},serverVersion:0,cachingFetch:function(_2b){var _2c=this;for(var i=0;i<this._fetchCache.length;i++){var _2d=this._fetchCache[i];var _2e=this.querySuperSet(_2d,_2b);if(_2e!==false){var _2f=_2d._loading;if(!_2f){_2f=new dojo.Deferred();_2f.callback(_2d.cacheResults);}_2f.addCallback(function(_30){_30=_2c.clientSideFetch(dojo.mixin(dojo.mixin({},_2b),{query:_2e}),_30);_2f.fullLength=_30._fullLength;return _30;});_2b._version=_2d._version;break;}}if(!_2f){var _31=dojo.mixin({},_2b);var _32=(_2b.queryOptions||0).cache;var _33=this._fetchCache;if(_32===undefined?this.cacheByDefault:_32){if(_2b.start||_2b.count){delete _31.start;delete _31.count;_2b.clientQuery=dojo.mixin(_2b.clientQuery||{},{start:_2b.start,count:_2b.count});}_2b=_31;_33.push(_2b);}_2f=_2b._loading=this._doQuery(_2b);_2f.addErrback(function(){_33.splice(dojo.indexOf(_33,_2b),1);});}var _34=this.serverVersion;_2f.addCallback(function(_35){delete _2b._loading;if(_35){_2b._version=typeof _2b._version=="number"?_2b._version:_34;_2c.updateResultSet(_35,_2b);_2b.cacheResults=_35;if(!_2b.count||_35.length<_2b.count){_2f.fullLength=((_2b.start)?_2b.start:0)+_35.length;}}return _35;});return _2f;},isUpdateable:function(_36){return typeof _36.query=="object";},clientSideFetch:function(_37,_38){if(_37.queryOptions&&_37.queryOptions.results){_38=_37.queryOptions.results;}if(_37.query){var _39=[];for(var i=0;i<_38.length;i++){var _3a=_38[i];if(_3a&&this.matchesQuery(_3a,_37)){_39.push(_38[i]);}}}else{_39=_37.sort?_38.concat():_38;}if(_37.sort){_39.sort(this.makeComparator(_37.sort.concat()));}return this.clientSidePaging(_37,_39);},clientSidePaging:function(_3b,_3c){var _3d=_3b.start||0;var _3e=(_3d||_3b.count)?_3c.slice(_3d,_3d+(_3b.count||_3c.length)):_3c;_3e._fullLength=_3c.length;return _3e;},matchesQuery:function(_3f,_40){var _41=_40.query;var _42=_40.queryOptions&&_40.queryOptions.ignoreCase;for(var i in _41){var _43=_41[i];var _44=this.getValue(_3f,i);if((typeof _43=="string"&&(_43.match(/[\*\.]/)||_42))?!dojo.data.util.filter.patternToRegExp(_43,_42).test(_44):_44!=_43){return false;}}return true;},makeComparator:function(_45){var _46=_45.shift();if(!_46){return function(){return 0;};}var _47=_46.attribute;var _48=!!_46.descending;var _49=this.makeComparator(_45);var _4a=this;return function(a,b){var av=_4a.getValue(a,_47);var bv=_4a.getValue(b,_47);if(av!=bv){return av<bv==_48?1:-1;}return _49(a,b);};}});cf.onUpdate=function(){};})();}
